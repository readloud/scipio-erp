<?xml version="1.0" encoding="UTF-8"?>
<!--
This file is subject to the terms and conditions defined in the
files 'LICENSE' and 'NOTICE', which are part of this source
code package.
-->

<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

    <!-- SCIPIO: NOTE: The old parameters.partyGlDecoratorLocation} pattern that existed here has been supplanted
        by the decorator default-fallback-location pattern for parameters.mainDecoratorLocation (see CommonScreens.xml). -->

    <screen name="PartyAccountsSummary">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingPartyAccountsSummary"/>
                <set field="activeSubMenuItem" value="PartyAccountsSummary"/>
                <set field="labelTitleProperty" value="AccountingPartyAccountsSummary"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <!-- entity-condition entity-name="GlAccountOrganization" list="entityList" use-cache="true" >
                    <condition-expr field-name="glAccountId" operator="greater" value="0"/>
                </entity-condition -->
                <set field="partyIds[]" from-field="organizationPartyId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <container style="${styles.grid_row}">                            
                                <include-screen name="StatsTransactions" />                            
                        </container>    
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
     
    <screen name="StatsTransactions">
      <section>
            <actions> 
                <set field="chartType" value="bar"/>
                <set field="chartValue" value="total"/>
               <!--  <set field="chartData" value="C"/> -->
                <set field="chartLibrary" value="chart"/>
                <set field="xlabel" value=""/> <!-- x-axis label -->
                <set field="ylabel" value=""/> <!-- y-axis label -->
                <set field="label1" value="${uiLabelMap.CommonTotal}"/> <!-- 1st dataset label -->
                <!-- <set field="label2" value="${uiLabelMap.AccountingExpenses}"/> 2nd dataset label -->  
                <set field="title" value="Total Transactions per Type"/>            
                <set field="glFiscalTypeId" from-field="parameters.glFiscalTypeId" default-value="ACTUAL"/>
                <service service-name="findLastClosedDate" result-map="findLastClosedDateOutMap">
                    <field-map field-name="organizationPartyId" from-field="organizationPartyId"/>
                </service>
                <if>
                    <condition>
                        <not><if-empty field="findLastClosedDateOutMap.lastClosedDate"/></not>
                    </condition>
                    <then>
                        <set field="fromDate" from-field="parameters.fromDate" type="Timestamp" default-value="${findLastClosedDateOutMap.lastClosedDate}"/>                        
                    </then>
                    <else>
                        <set field="fromDate" value="${nowTimestamp}" type="Timestamp"/>
                    </else>
                </if>
                <set field="thruDate" from-field="parameters.thruDate" type="Timestamp" default-value="${nowTimestamp}"/>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/accountSummary/StatsAccountSummaryTotal.groovy"/>
            </actions>
            <widgets>
                <platform-specific>
                    <html><html-template location="component://accounting/webapp/accounting/accountSummary/statsTransactionsTotals.ftl"/></html>
                </platform-specific>
            </widgets>
      </section>
    </screen>

    <screen name="FindAcctgTrans">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingAcctgTrans"/>
                <set field="activeSubMenuItem" value="FindAcctgTrans"/>
                <set field="labelTitleProperty" value="AccountingAcctgTrans"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.CommonSearchOptions}">
                          <!--   <container>
                                <link text="${uiLabelMap.AccountingCreateAnAccountingTransaction}" style="${styles.link_nav} ${styles.action_add}" target="newAcctgTrans">
                                    <parameter param-name="organizationPartyId"/>
                                </link>
                                <link text="${uiLabelMap.AccountingCreateAcctgTransAndEntries}" style="${styles.link_nav} ${styles.action_add}" target="CreateAcctgTransAndEntries">
                                    <parameter param-name="organizationPartyId"/>
                                </link>
                                <link text="${uiLabelMap.PageTitleUnpostedTransactions}" style="${styles.link_nav} ${styles.action_view}" target="ListUnpostedAcctgTrans">
                                    <parameter param-name="organizationPartyId"/>
                                </link>
                            </container> -->
                            <include-form name="FindAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.CommonSearchResults}">
                            <section>
                                <condition>
                                    <if-compare field="parameters.performSearch" operator="equals" value="Y"/>
                                </condition>
                                <widgets>
                                        <link text="${uiLabelMap.AccountingExportAsCsv}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransSearchResultsCsv.csv">
                                            <parameter param-name="organizationPartyId"/>
                                            <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                            <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                            <parameter param-name="productId" from-field="parameters.productId"/>
                                            <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                            <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                            <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                            <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                            <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                            <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                            <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                            <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                            <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                            <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        </link>
                                        <link text="${uiLabelMap.AccountingExportAsPdf}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransSearchResultPdf.pdf" target-window="_BLANK">
                                            <parameter param-name="organizationPartyId"/>
                                            <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                            <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                            <parameter param-name="productId" from-field="parameters.productId"/>
                                            <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                            <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                            <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                            <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                            <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                            <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                            <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                            <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                            <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                            <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        </link>
                                </widgets>
                            </section>
                            <include-form name="ListAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="FindAcctgTransEntries">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingAcctgTransEntries"/>
                <set field="activeSubMenuItem" value="FindAcctgTransEntries"/>
                <set field="labelTitleProperty" value="AccountingAcctgTransEntries"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.AccountingAcctgTransEntries}">
                            <include-form name="FindAcctgTransEntries" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                        <section>
                            <condition>
                                <and>
                                    <if-compare field="parameters.performSearch" operator="equals" value="Y"/>
                                    <if-compare field="parameters.reportType" operator="equals" value="byAccount"/>
                                </and>
                            </condition>
                            <widgets>
                                <screenlet title="${uiLabelMap.AccountingAcctgTransEntries} ${uiLabelMap.AccountingByAccount}">
                                    <link text="${uiLabelMap.AccountingExportAsCsv}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransEntriesSearchResultsCsv.csv">
                                        <parameter param-name="organizationPartyId"/>
                                        <parameter param-name="productId" from-field="parameters.productId"/>
                                        <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                        <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                        <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                        <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                        <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                        <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                        <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                        <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                        <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                        <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                        <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                    </link>
                                    <link text="${uiLabelMap.AccountingExportAsPdf}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransEntriesSearchResultsPdf.pdf" target-window="_BLANK">
                                        <parameter param-name="organizationPartyId"/>
                                        <parameter param-name="productId" from-field="parameters.productId"/>
                                        <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                        <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                        <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                        <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                        <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                        <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                        <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                        <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                        <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                        <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                        <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                    </link>
                                    <!-- Unsupported atm.
                                    <link text="${uiLabelMap.AccountingExportWithInvoiceAndPaymentAsPdf}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransEntriesSearchResultsInvoiceAndPaymentPdf.pdf" target-window="_BLANK">
                                        <parameter param-name="organizationPartyId"/>
                                        <parameter param-name="productId" from-field="parameters.productId"/>
                                        <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                        <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                        <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                        <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                        <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                        <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                        <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                        <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                        <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                        <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                        <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                    </link>-->
                                    <include-form name="ListFindAcctgTransEntriesByAccount" location="component://accounting/widget/ledger/GlForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <condition>
                                <and>
                                    <if-compare field="parameters.performSearch" operator="equals" value="Y"/>
                                    <if-compare field="parameters.reportType" operator="equals" value="byDate"/>
                                </and>
                            </condition>
                            <widgets>
                                <screenlet title="${uiLabelMap.AccountingAcctgTransEntries} ${uiLabelMap.AccountingByDate}">
                                    <link text="${uiLabelMap.AccountingExportAsCsv}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransEntriesSearchResultsCsv.csv">
                                        <parameter param-name="organizationPartyId"/>
                                        <parameter param-name="productId" from-field="parameters.productId"/>
                                        <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                        <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                        <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                        <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                        <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                        <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                        <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                        <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                        <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                        <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                        <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                    </link>
                                    <link text="${uiLabelMap.AccountingExportAsPdf}" style="${styles.link_run_sys} ${styles.action_export}" target="AcctgTransEntriesSearchResultsPdf.pdf" target-window="_BLANK">
                                        <parameter param-name="organizationPartyId"/>
                                        <parameter param-name="productId" from-field="parameters.productId"/>
                                        <parameter param-name="isPosted" from-field="parameters.isPosted"/>
                                        <parameter param-name="invoiceId" from-field="parameters.invoiceId"/>
                                        <parameter param-name="acctgTransId" from-field="parameters.acctgTransId"/>
                                        <parameter param-name="glFiscalTypeId" from-field="parameters.glFiscalTypeId"/>
                                        <parameter param-name="glAccountId" from-field="parameters.glAccountId"/>
                                        <parameter param-name="shipmentId" from-field="parameters.shipmentId"/>
                                        <parameter param-name="acctgTransTypeId" from-field="parameters.acctgTransTypeId"/>
                                        <parameter param-name="fromDate" from-field="parameters.fromDate"/>
                                        <parameter param-name="workEffortId" from-field="parameters.workEffortId"/>
                                        <parameter param-name="glJournalId" from-field="parameters.glJournalId"/>
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                        <parameter param-name="thruDate" from-field="parameters.thruDate"/>
                                        <parameter param-name="paymentId" from-field="parameters.paymentId"/>
                                    </link>
                                    <include-form name="ListFindAcctgTransEntriesByDate" location="component://accounting/widget/ledger/GlForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CreateAcctgTransAndEntries">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingCreateAcctgTransAndEntries"/>
                <set field="activeSubMenuItem" value="FindAcctgTrans"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="labelTitleProperty" value="AccountingCreateAcctgTransAndEntries"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="CreateAcctgTransAndEntries" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditAcctgTrans">
        <section>
            <actions>                
                <set field="titleProperty" value="PageTitleEditTransaction"/>
                <set field="activeSubMenuItem" value="FindAcctgTrans"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="acctgTransId" from-field="parameters.acctgTransId"/>

                <entity-one entity-name="AcctgTrans" value-field="acctgTrans"/>
                <entity-one entity-name="AcctgTransEntry" value-field="acctgTransEntry">
                    <field-map field-name="acctgTransId"/>
                    <field-map field-name="acctgTransEntrySeqId" from-field="parameters.editAcctgTransEntrySeqId"/>
                </entity-one>
                <entity-and entity-name="AcctgTransEntry" list="acctgTransEntries">
                    <field-map field-name="acctgTransId"/>
                    <order-by field-name="acctgTransEntrySeqId"/>
                </entity-and>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <not><if-empty field="acctgTransId"/></not>
                            </condition>
                            <widgets>
                                <section>
                                    <condition>
                                        <if-compare field="acctgTrans.isPosted" operator="equals"  value="Y"/>
                                    </condition>
                                    <widgets>
                                        <screenlet title="${uiLabelMap.AccountingTransactionHeader}">
                                            <include-form name="ViewAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                                        </screenlet>
                                        <screenlet title="${uiLabelMap.PageTitleViewTransactionEntries}">
                                            <include-form name="ViewAcctgTransEntries" location="component://accounting/widget/ledger/GlForms.xml"/>
                                        </screenlet>
                                    </widgets>
                                    <fail-widgets>
                                       <screenlet title="${uiLabelMap.AccountingTransactionHeader}">
                                            <include-form name="EditAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                                        </screenlet>
                                        <screenlet title="${uiLabelMap.PageTitleAddTransactionEntry}">
                                            <include-form name="EditAcctgTransEntry" location="component://accounting/widget/ledger/GlForms.xml"/>
                                        </screenlet>
                                        <screenlet title="${uiLabelMap.PageTitleEditTransactionEntries}">
                                            <include-form name="ListAcctgTransEntries" location="component://accounting/widget/ledger/GlForms.xml"/>
                                        </screenlet>
                                    </fail-widgets>
                                </section>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="ListUnpostedAcctgTrans">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="titleProperty" value="PageTitleUnpostedTransactions"/>
                <set field="activeSubMenuItem" value="FindAcctgTrans"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="labelTitleProperty" value="${uiLabelMap.PageTitleUnpostedTransactions}"/>
                <set field="partyId" from-field="parameters.organizationPartyId"/>
                <entity-condition entity-name="AcctgTrans" list="transactions">
                    <condition-expr field-name="isPosted" operator="not-equals" value="Y"/>
                    <order-by field-name="transactionDate"/>
                </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="ListUnpostedAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="ListChecksToPrint">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="titleProperty" value="AccountingPrintChecks"/>
                <set field="activeSubMenuItem" value="ChecksTabButton"/>
                <set field="activeSubMenuItem2" value="PrintChecksTabButton"/>
                <set field="labelTitleProperty" value="${uiLabelMap.AccountingPrintChecks}"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>

                <!-- find payments of paymentMethodType PERSONAL_CHECK or COMPANY_CHECK with statusId NOT_PAID -->
                <entity-condition entity-name="Payment" list="payments">
                    <condition-list combine="and">
                        <condition-expr field-name="partyIdFrom" operator="equals" from-field="organizationPartyId"/>
                        <condition-expr field-name="statusId" operator="equals" value="PMNT_NOT_PAID"/>
                        <condition-list combine="or">
                            <condition-expr field-name="paymentMethodTypeId" operator="equals" value="PERSONAL_CHECK"/>
                            <condition-expr field-name="paymentMethodTypeId" operator="equals" value="COMPANY_CHECK"/>
                        </condition-list>
                    </condition-list>
                    <order-by field-name="effectiveDate"/>
                </entity-condition>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/admin/FilterOutReceipts.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonAdminChecksDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="checks-body">
                        <section>
                        <condition><if-has-permission permission="ACCOUNTING" action="_PRINT_CHECKS"/></condition>
                        <widgets>
                            <screenlet>
                                <include-form name="ListChecksToPrint" location="component://accounting/widget/payments/PaymentForms.xml"/>
                            </screenlet>
                        </widgets>
                        <fail-widgets>
                            <label style="common-msg-error-perm">${uiLabelMap.AccountingPrintChecksPermissionError}</label>
                        </fail-widgets>
                      </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="ListChecksToSend">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="titleProperty" value="AccountingSendChecks"/>
                <set field="activeSubMenuItem" value="ChecksTabButton"/>
                <set field="activeSubMenuItem2" value="SendChecksTabButton"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>

                <!-- find payments of paymentMethodType PERSONAL_CHECK or COMPANY_CHECK with statusId NOT_PAID -->
                <entity-condition entity-name="Payment" list="payments">
                    <condition-list combine="and">
                        <condition-expr field-name="partyIdFrom" operator="equals" from-field="organizationPartyId"/>
                        <condition-expr field-name="statusId" operator="equals" value="PMNT_NOT_PAID"/>
                        <condition-list combine="or">
                            <condition-expr field-name="paymentMethodTypeId" operator="equals" value="PERSONAL_CHECK"/>
                            <condition-expr field-name="paymentMethodTypeId" operator="equals" value="COMPANY_CHECK"/>
                        </condition-list>
                    </condition-list>
                    <order-by field-name="effectiveDate"/>
                </entity-condition>
                <script location="component://accounting/webapp/accounting/WEB-INF/actions/admin/FilterOutReceipts.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonAdminChecksDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="checks-body">
                        <section>
                        <condition>
                            <or>
                                <if-has-permission permission="ACCOUNTING" action="_UPDATE"/>
                                <if-has-permission permission="PAY_INFO" action="_UPDATE"/>
                            </or>
                        </condition>
                        <widgets>
                            <screenlet>
                                <include-form name="ListChecksToSend" location="component://accounting/widget/payments/PaymentForms.xml"/>
                            </screenlet>
                        </widgets>
                        <fail-widgets>
                            <label style="common-msg-error-perm">${uiLabelMap.AccountingUpdatePaymentPermissionError}</label>
                        </fail-widgets>
                      </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="NewAcctgTrans">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingCreateAnAccountingTransaction"/>
                <set field="activeSubMenuItem" value="FindAcctgTrans"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="labelTitleProperty" value="AccountingCreateAnAccountingTransaction"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="CreateAcctgTrans" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="FindGlAccountReconciliation">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingAcctTransEntryRecon"/>
                <set field="activeSubMenuItem" value="AccountReconciliation"/>
                <set field="labelTitleProperty" value="AccountingAcctRecon"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="glAccountId" from-field="parameters.glAccountId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.CommonSearchOptions}">
                            <include-form name="FindGlAccountReconciliation" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.CommonSearchResults}">
                            <include-form name="ListGlAccountReconciliation" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="EditGlReconciliation">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingAcctGlRecon"/>
                <set field="activeSubMenuItem" from-field="parameters.activeSubMenuItem" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="glReconciliationId" from-field="parameters.glReconciliationId" global="true"/>
                <entity-one entity-name="GlReconciliation" value-field="glReconciliation"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.AccountingEditAcctRecon}">
                            <include-form name="EditGlReconciliation" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.AccountingEditAcctRecon}">
                            <include-form name="ListGlReconciliationEntries" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="FindGlAccountReconciliations">
        <section>
            <actions>
                <set field="titleProperty" value="AccountingAcctGlRecon"/>
                <set field="activeSubMenuItem" value="AccountReconciliations"/>
                <set field="labelTitleProperty" value="AccountingAcctRecons"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <set field="glAccountId" from-field="parameters.glAccountId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyGlDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.CommonSearchOptions}">
                            <include-form name="FindGlAccountReconciliations" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.CommonSearchResults}">
                            <include-form name="ListGlAccountReconciliations" location="component://accounting/widget/ledger/GlForms.xml"/>
                        </screenlet>                     
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="AcctgTransSearchResultsCsv">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>
            </actions>
            <widgets>
                <container>
                    <include-form name="AcctgTransSearchResultsCsv" location="component://accounting/widget/ledger/GlForms.xml"/>
                </container>
            </widgets>
        </section>
    </screen>

    <screen name="AcctgTransEntriesSearchResultsCsv">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>
            </actions>
            <widgets>
                <container>
                    <include-form name="AcctgTransEntriesSearchResultsCsv" location="component://accounting/widget/ledger/GlForms.xml"/>
                </container>
            </widgets>
        </section>
    </screen>

    <screen name="AcctgTransEntriesSearchResultsPdf">
        <section>
            <actions>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="WorkEffortUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <entity-condition entity-name="AcctgTransAndEntries" list="acctgTransEntryList">
                    <condition-list>
                        <condition-expr field-name="organizationPartyId" operator="equals" from-field="parameters.organizationPartyId"/>
                        <condition-expr field-name="glAccountId" operator="equals" from-field="parameters.glAccountId" ignore-if-empty="true"/>
                        <condition-expr field-name="acctgTransTypeId" operator="equals" from-field="parameters.acctgTransTypeId" ignore-if-empty="true"/>
                        <condition-expr field-name="glFiscalTypeId" operator="equals" from-field="parameters.glFiscalTypeId" ignore-if-empty="true"/>
                        <condition-expr field-name="glJournalId" operator="equals" from-field="parameters.glJournalId" ignore-if-empty="true"/>
                        <condition-expr field-name="isPosted" operator="equals" from-field="parameters.isPosted" ignore-if-empty="true"/>
                        <condition-expr field-name="partyId" operator="equals" from-field="parameters.partyId" ignore-if-empty="true"/>
                        <condition-expr field-name="invoiceId" operator="equals" from-field="parameters.invoiceId" ignore-if-empty="true"/>
                        <condition-expr field-name="paymentId" operator="equals" from-field="parameters.paymentId" ignore-if-empty="true"/>
                        <condition-expr field-name="productId" operator="equals" from-field="parameters.productId" ignore-if-empty="true"/>
                        <condition-expr field-name="workEffortId" operator="equals" from-field="parameters.workEffortId" ignore-if-empty="true"/>
                        <condition-expr field-name="shipmentId" operator="equals" from-field="parameters.shipmentId" ignore-if-empty="true"/>
                        <condition-expr field-name="acctgTransId" operator="equals" from-field="parameters.acctgTransId" ignore-if-empty="true"/>
                        <condition-expr field-name="transactionDate" operator="greater-equals" from-field="parameters.fromDate" ignore-if-empty="true"/>
                        <condition-expr field-name="transactionDate" operator="less" from-field="parameters.thruDate" ignore-if-empty="true"/>
                    </condition-list>
                    <order-by field-name="-transactionDate"/>
                </entity-condition>
            </actions>
            <widgets>
                <platform-specific>
                    <xsl-fo>
                        <html-template location="component://accounting/webapp/accounting/reports/AcctgTransEntriesSearchResult.fo.ftl"/>
                    </xsl-fo>
                </platform-specific>
            </widgets>
        </section>
    </screen>
    <screen name="AcctgTransSearchResultPdf">
        <section>
            <actions>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="WorkEffortUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId" global="true"/>
                <entity-condition entity-name="AcctgTransAndEntries" list="acctgTransList" distinct="true" >
                    <condition-list>
                        <condition-expr field-name="organizationPartyId" operator="equals" from-field="organizationPartyId"/>
                        <condition-expr field-name="acctgTransTypeId" operator="equals" from-field="parameters.acctgTransTypeId" ignore-if-empty="true"/>
                        <condition-expr field-name="glFiscalTypeId" operator="equals" from-field="parameters.glFiscalTypeId" ignore-if-empty="true"/>
                        <condition-expr field-name="glJournalId" operator="equals" from-field="parameters.glJournalId" ignore-if-empty="true"/>
                        <condition-expr field-name="isPosted" operator="equals" from-field="parameters.isPosted" ignore-if-empty="true"/>
                        <condition-expr field-name="invoiceId" operator="equals" from-field="parameters.invoiceId" ignore-if-empty="true"/>
                        <condition-expr field-name="paymentId" operator="equals" from-field="parameters.paymentId" ignore-if-empty="true"/>
                        <condition-expr field-name="productId" operator="equals" from-field="parameters.productId" ignore-if-empty="true"/>
                        <condition-expr field-name="workEffortId" operator="equals" from-field="parameters.workEffortId" ignore-if-empty="true"/>
                        <condition-expr field-name="shipmentId" operator="equals" from-field="parameters.shipmentId" ignore-if-empty="true"/>
                        <condition-expr field-name="acctgTransId" operator="equals" from-field="parameters.acctgTransId" ignore-if-empty="true"/>
                        <condition-expr field-name="transactionDate" operator="greater-equals" from-field="parameters.fromDate" ignore-if-empty="true"/>
                        <condition-expr field-name="transactionDate" operator="less" from-field="parameters.thruDate" ignore-if-empty="true"/>
                    </condition-list>
                    <select-field field-name="acctgTransId"/>
                    <select-field field-name="transactionDate"/>
                    <select-field field-name="acctgTransTypeId"/>
                    <select-field field-name="glFiscalTypeId"/>
                    <select-field field-name="invoiceId"/>
                    <select-field field-name="paymentId"/>
                    <select-field field-name="workEffortId"/>
                    <select-field field-name="shipmentId"/>
                    <select-field field-name="isPosted"/>
                    <select-field field-name="postedDate"/>
                    <order-by field-name="-transactionDate"/>
                </entity-condition>
            </actions>
            <widgets>
                <platform-specific>
                    <xsl-fo>
                        <html-template location="component://accounting/webapp/accounting/reports/AcctgTransSearchResult.fo.ftl"/>
                    </xsl-fo>
                </platform-specific>
            </widgets>
        </section>
    </screen>

    <screen name="AcctgTransDetailReportPdf">
        <section>
            <actions>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="acctgTransId" from-field="parameters.acctgTransId"/>
                <entity-one entity-name="AcctgTrans" value-field="acctgTrans"/>
                <entity-and entity-name="AcctgTransEntry" list="acctgTransEntries">
                    <field-map field-name="acctgTransId"/>
                    <order-by field-name="acctgTransEntrySeqId"/>
                </entity-and>
            </actions>
            <widgets>
                <decorator-screen name="SimpleDecorator" location="component://common/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <include-form name="AcctgTransDetailReportPdf" location="component://accounting/widget/ledger/GlForms.xml"/>
                        <include-form name="AcctgTransEntriesDetailReportPdf" location="component://accounting/widget/ledger/GlForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
</screens>
