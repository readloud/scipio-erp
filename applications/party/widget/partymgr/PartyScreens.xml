<?xml version="1.0" encoding="UTF-8"?>
<!--
This file is subject to the terms and conditions defined in the
files 'LICENSE' and 'NOTICE', which are part of this source
code package.
-->

<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

    <!-- Party Find Screen -->
    <screen name="findparty">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleFindParty"/>
                <set field="activeSubMenuItem" value="findparty"/>
                <service service-name="findParty" auto-field-map="parameters"/>
                
                <set field="searchPerformed" type="Boolean" value="${groovy: parameters.lookupFlag == 'Y'}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <!-- do check for PARTYMGR, _VIEW permission -->
                            <condition>
                                <if-service-permission service-name="partyBasePermissionCheck" main-action="VIEW"/>
                            </condition>
                            <widgets>
                                <platform-specific>
                                    <html><html-template location="component://party/webapp/partymgr/party/findparty.ftl"/></html>
                                </platform-specific>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm" text="${uiLabelMap.PartyMgrViewPermissionError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- Party Profile Screens -->
    <!-- SCIPIO: Changelist
               * Removed portal page reference
               * Removed "showOld buttons
     -->
    <screen name="viewprofile">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <set field="title" value="${uiLabelMap.PartyProfile}: ${partyId}"/>
                <set field="activeSubMenuItem" value="viewprofile"/>
                <set field="layoutSettings.javaScripts[]" value="/partymgr/static/PartyProfileContent.js" global="true"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/ViewProfile.groovy"/>
                <!--<set field="widePage" type="Boolean" value="true" />-->
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <actions>
                                <if>
                                    <condition>
                                        <and>
                                            <if-empty field="partyId"/>
                                            <not><if-empty field="parameters.telno"/></not>
                                        </and>
                                    </condition>
                                    <then>
                                        <service service-name="findPartyFromTelephone" auto-field-map="true" result-map="telnoMap"/>
                                        <entity-one entity-name="Party" value-field="party">
                                            <field-map field-name="partyId" from-field="telnoMap.partyId"/>
                                        </entity-one>
                                        <set field="parameters.partyId" from-field="party.partyId"/>
                                    </then>
                                </if>
                                <if>
                                    <condition>
                                        <and>
                                            <if-empty field="partyId"/>
                                            <not><if-empty field="parameters.email"/></not>
                                        </and>
                                    </condition>
                                    <then>
                                        <service service-name="findPartyFromEmailAddress" result-map="emailMap">
                                            <field-map field-name="address" from-field="parameters.email"/>
                                        </service>
                                        <entity-one entity-name="Party" value-field="party">
                                            <field-map field-name="partyId" from-field="emailMap.partyId"/>
                                        </entity-one>
                                        <set field="parameters.partyId" from-field="party.partyId"/>
                                    </then>
                                </if>
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="party"/></not>
                                    </condition>
                                    <widgets>
                                        <include-menu location="component://party/widget/partymgr/PartyMenus.xml" name="ProfileSubTabBar"/>
                                        <!--
                                        <section>
                                            <condition>
                                                <if-true field="showOld"/>
                                            </condition>
                                            <widgets>
                                                <container style="button-bar button-style-2">
                                                    <link target="viewprofile" text="${uiLabelMap.PartyHideOld}" style="${styles.link_run_sys} ${styles.action_hide}">
                                                        <parameter param-name="partyId" from-field="party.partyId"/>
                                                    </link>
                                                </container>
                                            </widgets>
                                            <fail-widgets>
                                                <container style="button-bar button-style-2">
                                                    <link target="viewprofile" text="${uiLabelMap.PartyShowOld}" style="${styles.link_run_sys} ${styles.action_show}">
                                                        <parameter param-name="partyId" from-field="party.partyId"/>
                                                        <parameter param-name="SHOW_OLD" value="true"/>
                                                    </link>
                                                </container>
                                            </fail-widgets>
                                         </section>-->
                                         <container style="${styles.grid_row}">
                                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                                <include-screen name="Party" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                <!--
                                                    <include-screen name="Content" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                    <include-screen name="Attributes" location="component://party/widget/partymgr/ProfileScreens.xml"/> 
                                                    <include-screen name="partyRelContacts" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                    <include-screen name="partyRelAccounts" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                -->
                                                <include-screen name="LoyaltyPoints" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                <include-screen name="UserLogin" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                            </container>
                                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                                <include-screen name="Contact" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                                <include-screen name="Visits" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                            </container>
                                        </container>
                                        <container style="${styles.grid_row}">
                                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                                <include-screen name="PaymentMethods" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                             </container>
                                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                                <include-screen name="PartyIdentifications" location="component://party/widget/partymgr/ProfileScreens.xml"/>
                                            </container>
                                        </container>
                                        <container style="${styles.grid_row}">
                                            <container style="${styles.grid_large}12 ${styles.grid_cell}">
                                                <include-screen name="Notes" location="component://party/widget/partymgr/ProfileScreens.xml"/>                                                                                    
                                             </container>
                                        </container>
                                    </widgets>
                                    <fail-widgets>
                                        <container>
                                            <label style="common-msg-error">${uiLabelMap.PartyNoPartyFoundWithPartyId}: ${parameters.partyId}</label>
                                        </container>
                                    </fail-widgets>
                                </section>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="viewroles">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewPartyRole"/>
                <set field="activeSubMenuItem" value="viewroles"/>
                <set field="labelTitleProperty" value="PartyMemberRoles"/>
                <entity-condition entity-name="RoleTypeAndParty" list="partyRoles">
                    <condition-list combine="and">
                        <condition-expr field-name="partyId" operator="equals" value="${parameters.partyId}"/>
                        <condition-expr field-name="roleTypeId" operator="not-equals" value="_NA_"/>
                    </condition-list>
                </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.PartyMemberRoles}" navigation-form-name="ViewPartyRoles">
                            <include-form name="ViewPartyRoles" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_UPDATE"/>
                            </condition>
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyAddToRole}">
                                    <container>
                                        <label style="heading">${uiLabelMap.PartyAddToMainRole}</label>
                                        <include-form name="AddPartyMainRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        <container id="addPartySecondaryRole"/>
                                    </container>
                                    <container>
                                        <label style="heading">${uiLabelMap.PartyAddToRoleViewAll}</label>
                                        <include-form name="AddPartyRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    </container>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                            </condition>
                            <actions>
                                <entity-condition entity-name="RoleType" list="parentRoleList">
                                    <condition-expr field-name="parentTypeId" operator="equals" from-field="nullField"/>
                                    <order-by field-name="description"/>
                                </entity-condition>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyNewRoleType}">
                                    <include-form name="AddRoleType" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="AddPartySecondaryRoles">
        <section>
            <actions>
                <property-map map-name="uiLabelMap" resource="CommonUiLabels"/>
                <property-map map-name="uiLabelMap" resource="PartyUiLabels"/>
            </actions>
            <widgets>
                <label style="heading">${uiLabelMap.PartyAddToSecondRole}</label>
                <include-form name="AddPartySecondaryRoles" location="component://party/widget/partymgr/PartyForms.xml"/>
            </widgets>
        </section>
    </screen>
    <screen name="linkparty">
        <section>
            <actions>
                <set field="titleProperty" value="PartyLink"/>
                <set field="activeSubMenuItem" value="linkparty"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_UPDATE"/>
                            </condition>
                            <widgets>
                                <screenlet>
                                    <label text="${uiLabelMap.PartyLinkExplanation}"></label>
                                    <include-form name="PartyLink" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm" text="${uiLabelMap.PartyPermissionError}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditPartyRelationships">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditPartyRelationships"/>
                <set field="activeSubMenuItem" value="EditPartyRelationships"/>
                <set field="labelTitleProperty" value="PartyRelationships"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party"/>
                <entity-condition entity-name="RoleType" list="roleTypes">
                    <order-by field-name="description"/>
                    <order-by field-name="roleTypeId"/>
                </entity-condition>
                <entity-condition entity-name="RoleTypeAndParty" list="roleTypesForCurrentParty">
                 <condition-expr field-name="partyId" from-field="partyId"/>
                 <order-by field-name="description"/>
                 <order-by field-name="roleTypeId"/>
                </entity-condition>
                <entity-condition entity-name="PartyRelationshipType" list="relateTypes">
                    <order-by field-name="description"/>
                    <order-by field-name="partyRelationshipTypeId"/>
                </entity-condition>
                <entity-condition entity-name="PartyRelationship" list="partyRelationships">
                    <condition-list combine="or">
                        <condition-expr field-name="partyIdTo" from-field="partyId"/>
                        <condition-expr field-name="partyIdFrom" from-field="partyId"/>
                    </condition-list>
                    <order-by field-name="partyIdTo"/>
                    <order-by field-name="partyRelationshipTypeId"/>
                    <order-by field-name="-fromDate"/>
                </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.PartyRelationships}">
                            <include-form name="ListPartyRelationships" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <container style="${styles.grid_row}">
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                <section>
                                    <condition>
                                        <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                                    </condition>
                                    <widgets>
                                        <screenlet title="${uiLabelMap.PartyNewRelationshipType}">
                                            <include-form name="AddPartyRelationshipType" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </screenlet>
                                    </widgets>
                                </section>
                            </container>
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                <screenlet title="${uiLabelMap.PartyAddOtherRelationship}">
                                    <include-form name="AddOtherPartyRelationship" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </container>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="viewvendor">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewVendorParty"/>
                <set field="activeSubMenuItem" value="viewvendor"/>

                <set field="labelTitleProperty" value="PartyVendorInformation"/>

                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party"/>
                <entity-one entity-name="Vendor" value-field="vendor"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet><!--  title="${uiLabelMap.PartyVendorInformation}" -->
                            <include-form name="EditVendor" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditPartyAttribute">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditPartyAttribute"/>
                <set field="activeSubMenuItem" value="viewvendor"/>

                <set field="labelTitleProperty" value="PartyAttribute"/>

                <set field="cancelPage" from-field="parameters.CANCEL_PAGE" default-value="viewprofile"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <set field="attrName" from-field="parameters.attrName"/>
                <entity-one entity-name="Party" value-field="party"/>
                <entity-one entity-name="PartyAttribute" value-field="attribute"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.PartyAttribute}">
                            <include-form name="EditPartyAttribute" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditPartyTaxAuthInfos">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditPartyTaxAuthInfos"/>
                <set field="activeSubMenuItem" value="EditPartyTaxAuthInfos"/>
                <set field="labelTitleProperty" value="PartyTaxAuthInfos"/>

                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party"/>
                <entity-and entity-name="PartyTaxAuthInfo" list="partyTaxInfos">
                    <field-map field-name="partyId"/>
                    <order-by field-name="taxAuthGeoId"/>
                    <order-by field-name="taxAuthPartyId"/>
                    <order-by field-name="fromDate"/>
                </entity-and>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet id="AddPartyTaxAuthInfospanel" title="${uiLabelMap.PageTitleAddPartyTaxAuthInfos}" collapsible="true">
                            <include-form name="AddPartyTaxAuthInfo" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <include-form name="UpdatePartyTaxAuthInfo" location="component://party/widget/partymgr/PartyForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="editShoppingList">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleShoppingList"/>
                <set field="activeSubMenuItem" value="editShoppingList"/>

                <set field="labelTitleProperty" value="PartyShoppingLists"/>

                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/EditShoppingList.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <platform-specific>
                            <html><html-template location="component://party/webapp/partymgr/party/editShoppingList.ftl"/></html>
                        </platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="editcontactmech">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditContactMech"/>
                <set field="activeSubMenuItem" from-field="activeSubMenuItem" default-value="editcontactmech"/>

                <set field="labelTitleProperty" value="PageTitleEditContactMech"/>

                <script location="component://party/webapp/partymgr/WEB-INF/actions/HasPartyPermissions.groovy"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/EditContactMech.groovy"/>

                <set field="dependentForm" value="editcontactmechform"/>
                <set field="paramKey" value="countryGeoId"/>
                <set field="mainId" value="countryGeoId"/>
                <set field="dependentId" value="stateProvinceGeoId"/>
                <set field="requestName" value="getAssociatedStateList"/>
                <set field="responseName" value="stateList"/>
                <set field="dependentKeyName" value="geoId"/>
                <set field="descName" value="geoName"/>
                <set field="selectedDependentOption" from-field="mechMap.postalAddress.stateProvinceGeoId" default-value="_none_"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-true field="hasViewPermission" />
                                    <if-true field="hasPcmCreatePermission" />
                                    <if-true field="hasPcmUpdatePermission" />
                                    <if-compare-field field="parameters.partyId" operator="equals" to-field="userLogin.partyId"/>
                                    <!-- SCIPIO: having this check here makes no sense from security perspective
                                    <not><if-empty field="mechMap.partyContactMech"/></not>-->
                                </or>
                            </condition>
                            <widgets>
                                <section><!-- SCIPIO: separated the partyContactMech record check from the security perm checks  -->
                                    <condition>
                                        <or>
                                            <not><if-empty field="mechMap.partyContactMech"/></not>
                                            <if-empty field="parameters.contactMechId"/><!-- SCIPIO: explicit check needed for new contact mech creation -->
                                        </or>
                                    </condition>
                                    <widgets>
                                        <platform-specific>
                                            <html>
                                                <html-template location="component://common/webcommon/includes/setDependentDropdownValuesJs.ftl"/>
                                                <html-template location="component://party/webapp/partymgr/party/editcontactmech.ftl"/>
                                            </html>
                                        </platform-specific>
                                    </widgets>
                                    <fail-widgets>
                                        <container style="button-bar">
                                            <link target="backHome" text="${uiLabelMap.CommonBack}" style="${styles.link_nav_cancel}"/>
                                        </container>
                                        <container>
                                            <label style="common-msg-error">${uiLabelMap.PartyContactInfoNotBelongToPartyOrExpired}</label>
                                        </container>
                                    </fail-widgets>
                                </section>
                            </widgets>
                            <fail-widgets>
                                <container style="button-bar">
                                    <link target="backHome" text="${uiLabelMap.CommonBack}" style="${styles.link_nav_cancel}"/>
                                </container>
                                <container>
                                    <label style="common-msg-error-perm">${uiLabelMap.PartyMsgContactNotBelongToYou}</label>
                                </container>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditPerson">
        <section>
            <actions>
                <set field="labelTitleProperty" value="PageTitleEditPersonalInformation"/>

                <set field="donePage" from-field="parameters.DONE_PAGE" default-value="viewprofile"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="PartyAndPerson" value-field="personInfo"/>
                <set field="activeSubMenuItem" value="${groovy: context.personInfo ? 'viewprofile' : 'newperson'}"/>
                <set field="titleProperty" value="${groovy: context.personInfo ? 'PageTitleEditPersonalInformation' : 'PartyCreateNewPerson'}"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="EditPerson" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="EditPartyGroup">
        <section>
            <actions>
                <set field="labelTitleProperty" value="PageTitleEditGroupInformation"/>

                <set field="donePage" from-field="parameters.DONE_PAGE" default-value="viewprofile"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="PartyAndGroup" value-field="partyGroup"/>
                
                <set field="activeSubMenuItem" value="${groovy: context.partyGroup ? 'viewprofile' : 'newpartygroup'}"/>
                <set field="titleProperty" value="${groovy: context.partyGroup ? 'PageTitleEditGroupInformation' : 'PartyCreateNewPartyGroup'}"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="EditPartyGroup" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: Remove - This is a duplicate of component://common/widget/SecurityScreens.xml#EditUserLogin -->
    <screen name="EditUserLogin">
        <section>
            <actions>
                <set field="titleProperty" value="UserLoginUpdateSecuritySettings"/>
                <set field="activeSubMenuItem" value="viewprofile"/>
                <set field="labelTitleProperty" value="UserLoginUpdateSecuritySettings"/>
                <set field="updateUserLoginSecurityURI" value="ProfileUpdateUserLoginSecurity"/>
                <set field="updatePasswordURI" value="ProfileUpdatePassword"/>
                <set field="cancelPage" from-field="parameters.CANCEL_PAGE" default-value="viewprofile"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <set field="userLoginId" from-field="parameters.userLoginId"/>
                <entity-one entity-name="UserLogin" value-field="editUserLogin"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-screen name="component://common/widget/SecurityScreens.xml#updateUserLoginSecurity"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.UserLoginChangePassword}">
                            <include-form name="updatePassword" location="component://common/widget/SecurityForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="CreateUserLogin">
        <section>
            <actions>
                <set field="titleProperty" value="CreateUserLogin"/>
                <set field="activeSubMenuItem" value="viewprofile"/>
                <set field="labelTitleProperty" value="CreateUserLogin"/>
                <set field="cancelPage" from-field="parameters.CANCEL_PAGE" default-value="viewprofile"/>
                <set field="createUserLoginURI" value="ProfileCreateUserLogin"/>
                <set field="partyId" from-field="parameters.partyId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="AddUserLogin" location="component://common/widget/SecurityForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="EditUserLoginSecurityGroups">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditUserLoginSecurityGroups"/>
                <set field="activeSubMenuItem" value="viewprofile"/>
                <set field="cancelPage" from-field="parameters.CANCEL_PAGE" default-value="viewprofile"/>
                <set field="addUserLoginSecurityGroupURI" value="ProfileAddUserLoginToSecurityGroup"/>
                <set field="removeUserLoginSecurityGroupURI" value="ProfileRemoveUserLoginFromSecurityGroup"/>
                <set field="updateUserLoginSecurityGroupURI" value="ProfileUpdateUserLoginToSecurityGroup"/>
                <set field="userLoginId" from-field="parameters.userLoginId"/>
                <entity-one entity-name="UserLogin" value-field="editUserLogin"/>
                <set field="partyId" from-field="parameters.partyId" default-value="${editUserLogin.partyId}"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet id="AddUserLoginSecurityGroupsPanel" title="${uiLabelMap.AddUserLoginToSecurityGroup}" collapsible="true">
                            <include-form name="AddUserLoginSecurityGroup" location="component://common/widget/SecurityForms.xml"/>
                        </screenlet>
                        <include-form name="ListUserLoginSecurityGroups" location="component://common/widget/SecurityForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="AddPartyNote">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleNewPartyNote"/>
                <set field="activeSubMenuItem" value="viewprofile"/>
                <set field="labelTitleProperty" value="PageTitleNewPartyNote"/>

                <set field="donePage" from-field="parameters.DONE_PAGE" default-value="viewprofile"/>
                <set field="partyId" from-field="parameters.partyId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <include-form name="AddPartyNote" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="EditPartyRates">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleEditPartyRates"/>
                <set field="activeSubMenuItem" value="EditPartyRates"/>
                <set field="labelTitleProperty" value="PageTitleEditPartyRates"/>

                <set field="partyId" from-field="parameters.partyId"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet id="AddPartyRatesPanel" collapsible="true"><!--  title="${uiLabelMap.PageTitleEditPartyRates}" -->
                            <include-form name="AddPartyRate" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <include-form name="ListPartyRates" location="component://party/widget/partymgr/PartyForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="ViewSegmentRoles">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewPartySegmentRoles"/>
                <set field="activeSubMenuItem" value="ViewSegmentRoles"/>

                <set field="labelTitleProperty" value="ViewSegmentRoles"/>

                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet id="AddSegmentRolePanel" title="${uiLabelMap.PageTitleAddPartySegmentRoles}" collapsible="true">
                            <include-form name="AddSegmentRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <include-form name="ListSegmentRoles" location="component://party/widget/partymgr/PartyForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- Create New Party Screen -->
    <screen name="CreateNewParty">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleCreateNewPartyDetail"/>
                <set field="activeSubMenuItem" value="find"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyAppDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                            </condition>
                            <widgets>
                                <screenlet>
                                    <label text="${uiLabelMap.PartySelectTypePartyToCreate}:"/>
                                    <include-menu location="component://party/widget/partymgr/PartyMenus.xml" name="create-new-party"/>
                                </screenlet>
                                <!--
                                <screenlet navigation-menu-name="create-new-party">
                                    <include-menu location="component://party/widget/partymgr/PartyMenus.xml" name="create-new-party"/>
                                </screenlet>
                                -->
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- New Customer Party Screen -->
    <screen name="NewCustomer">
        <section>
            <actions>
                <set field="titleProperty" value="PartyCreateNewCustomer"/>
                <set field="target" value="createCustomer"/>
                <set field="displayPassword" value="true" type="Boolean"/>
                <set field="previousParams" from-field="_PREVIOUS_PARAMS_" from-scope="user"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="country.geo.id.default" default="USA"/>
                <set field="activeSubMenuItem" value="newcustomer"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                            </condition>
                            <actions>
                                <!-- fields for setDependentDropdownValuesJs.ftl -->
                                <set field="dependentForm" value="NewUser"/>
                                <set field="paramKey" value="countryGeoId"/>
                                <set field="mainId" value="USER_COUNTRY"/>
                                <set field="dependentId" value="USER_STATE"/>
                                <set field="requestName" value="getAssociatedStateList"/>
                                <set field="responseName" value="stateList"/>
                                <set field="dependentKeyName" value="geoId"/>
                                <set field="descName" value="geoName"/>
                                <set field="selectedDependentOption" value="_none_"/>
                                <set field="focusFieldName" value="NewUser_USER_PARTY_ID"/>
                            </actions>
                            <widgets>
                                <platform-specific><html><html-template location="component://common/webcommon/includes/setDependentDropdownValuesJs.ftl"/></html></platform-specific>
                                <screenlet>
                                    <include-form name="NewUser" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- New Prospect Party Screen -->
    <screen name="NewProspect">
        <section>
            <actions>
                <set field="titleProperty" value="PartyCreateNewProspect"/>
                <set field="displayPassword" value="true" type="Boolean"/>
                <set field="target" value="createProspect"/>
                <set field="previousParams" from-field="_PREVIOUS_PARAMS_" from-scope="user"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="country.geo.id.default" default="USA"/>
                <set field="activeSubMenuItem" value="newprospect"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                            </condition>
                            <actions>
                                <!-- fields for setDependentDropdownValuesJs.ftl -->
                                <set field="dependentForm" value="NewUser"/>
                                <set field="paramKey" value="countryGeoId"/>
                                <set field="mainId" value="USER_COUNTRY"/>
                                <set field="dependentId" value="USER_STATE"/>
                                <set field="requestName" value="getAssociatedStateList"/>
                                <set field="responseName" value="stateList"/>
                                <set field="dependentKeyName" value="geoId"/>
                                <set field="descName" value="geoName"/>
                                <set field="selectedDependentOption" value="_none_"/>
                            </actions>
                            <widgets>
                                <platform-specific><html><html-template location="component://common/webcommon/includes/setDependentDropdownValuesJs.ftl"/></html></platform-specific>
                                <screenlet>
                                    <include-form name="NewUser" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- New Emplyee Party Screen -->
    <screen name="NewEmployee">
        <section>
            <actions>
                <set field="titleProperty" value="PartyCreateNewEmployee"/>
                <set field="activeSubMenuItem" value="newemployee"/>
                <set field="displayPassword" value="true" type="Boolean"/>
                <set field="target" value="createEmployee"/>
                <set field="previousParams" from-field="_PREVIOUS_PARAMS_" from-scope="user"/>
                <property-to-field field="defaultCountryGeoId" resource="general" property="country.geo.id.default" default="USA"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="PARTYMGR" action="_CREATE"/>
                            </condition>
                            <actions>
                                <!-- fields for setDependentDropdownValuesJs.ftl -->
                                <set field="dependentForm" value="NewUser"/>
                                <set field="paramKey" value="countryGeoId"/>
                                <set field="mainId" value="USER_COUNTRY"/>
                                <set field="dependentId" value="USER_STATE"/>
                                <set field="requestName" value="getAssociatedStateList"/>
                                <set field="responseName" value="stateList"/>
                                <set field="dependentKeyName" value="geoId"/>
                                <set field="descName" value="geoName"/>
                                <set field="selectedDependentOption" value="_none_"/>
                            </actions>
                            <widgets>
                                <platform-specific><html><html-template location="component://common/webcommon/includes/setDependentDropdownValuesJs.ftl"/></html></platform-specific>
                                <screenlet>
                                    <include-form name="NewUser" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.PartyMgrCreatePermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- Address Match Map Screen 
    
    ToDo: Remove
    Has never been implemented as discussed here 
    http://ofbiz.135035.n4.nabble.com/Address-match-map-is-used-for-td157597.html

    <screen name="AddressMatchMap">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleAddressMatchMap"/>
                <set field="activeSubMenuItem" value="addrmap"/>
                <entity-condition entity-name="AddressMatchMap" list="addressMatchMaps">
                    <order-by field-name="sequenceNum"/>
                </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyAppDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <platform-specific>
                            <html><html-template location="component://party/webapp/partymgr/party/addressMatchMap.ftl"/></html>
                        </platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="FindAddressMatch">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleAddressMatches"/>
                <set field="activeSubMenuItem" value="addrmap"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/FindMatches.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyAppDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <platform-specific>
                            <html><html-template location="component://party/webapp/partymgr/party/findMatches.ftl"/></html>
                        </platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    -->
    <!-- Party Content Screen 
        SCIPIO: 2018: TODO: REVIEW: this screen does not honor filter-by-date logic on PartyContent -->
    <screen name="EditPartyContents">
        <section>
            <actions>
                <set field="titleProperty" from-field="titleProperty" default-value="PageTitleListContent"/>
                <set field="activeSubMenuItem" from-field="activeSubMenuItem" default-value="PartyContents"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <set field="contentId" from-field="parameters.contentId"/>
                <entity-one entity-name="Content" value-field="content"/>
                
                <!-- SCIPIO: 2018: we can't accept a Content here that's not already related to the Party (or assoc was removed) -->
                <if>
                    <condition><not><if-empty field="content"/></not></condition>
                    <then>
                        <entity-and entity-name="PartyContent" list="partyContentList" filter-by-date="false">
                            <field-map field-name="partyId"/>
                            <field-map field-name="contentId"/>
                        </entity-and>
                        <if>
                            <condition><if-empty field="partyContentList"/></condition>
                            <then>
                                <set field="content" type="Object" value=""/>
                            </then>
                        </if>
                    </then>
                </if>
                
                <!-- SCIPIO: if editing a record, must look it up here -->
                <if>
                    <condition>
                        <and>
                            <not><if-empty field="partyId"/></not>
                            <not><if-empty field="contentId"/></not>
                            <not><if-empty field="parameters.fromDate"/></not>
                            <not><if-empty field="parameters.partyContentTypeId"/></not>
                        </and>
                    </condition>
                    <then>
                        <entity-one entity-name="PartyContent" value-field="partyContent">
                            <field-map field-name="partyId"/>
                            <field-map field-name="contentId"/>
                            <field-map field-name="partyContentTypeId" from-field="parameters.partyContentTypeId"/>
                            <field-map field-name="fromDate" from-field="parameters.fromDate"/>
                        </entity-one>
                    </then>
                    <else>
                        <set field="partyContent" type="Object" value=""/>
                    </else>
                </if>
                
                <!-- TODO: REVIEW: header & title stuff, this is due to CommonPartyDecorator lingering in humanres -->
                <set field="skipProfileHeader" type="Boolean" value="true"/>
                <set field="titleFormat" from-field="titleFormat" default-value="\${finalTitle}${groovy: context.partyId ? (': ' + context.partyId) : ''}"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet><!-- title="${uiLabelMap.PageTitleListContent}"-->
                            <!-- links to same page
                            <container>
                                <link target="EditPartyContents" text="${uiLabelMap.CommonCreateNew}" style="${styles.link_nav} ${styles.action_add}">
                                    <parameter param-name="partyId"/>
                                </link>
                            </container>-->
                            <section>
                                <actions>
                                    <set field="paginateTarget" value="EditPartyContents?partyId=${parameters.partyId}" />
                                </actions>
                                <widgets>
                                    <include-form name="ListPartyContents" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </widgets>
                            </section>
                        </screenlet>
                        <section>
                            <actions>          
                                <set field="showProgress" type="Boolean" value="true" /> 
                                <set field="progressSuccessAction" value="redirect;;EditPartyContents?partyId=${parameters.partyId}" />
                                <set field="progressOptions" value="{}" />
                            </actions>
                            <widgets>
                                <screenlet title="${groovy: context.content ? uiLabelMap.PageTitleEditPartyContent : uiLabelMap.PageTitleAddPartyContent}" navigation-menu-name="PartyContentAddEditSubTabBar">
                                    <include-menu name="PartyContentAddEditSubTabBar" location="component://party/widget/partymgr/PartyMenus.xml"/><!-- SCIPIO: new -->
                                    <include-form name="AddPartyContent" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="editCarrierAccount">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitlePartyCarrierAccount"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.PartyShipperAccount}">
                            <include-form name="EditCarrierAccount" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="EditPartyResumes">
        <section>
            <actions>
                <set field="titleProperty" value="HumanResEditPartyResume"/>
                <set field="activeSubMenuItem" value="EditPartyResumes"/>
                <set field="resumeId" from-field="parameters.resumeId"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="PartyResume" value-field="partyResume"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet id="EditPartyResumePanel" title="${uiLabelMap.CommonAdd} ${uiLabelMap.PartyParty} ${uiLabelMap.HumanResPartyResume}" collapsible="true">
                            <include-form name="EditPartyResume" location="component://humanres/widget/forms/PartyResumeForms.xml"/>
                        </screenlet>
                        <include-form name="ListPartyResumes" location="component://humanres/widget/forms/PartyResumeForms.xml"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="PartyFinancialHistory">
        <section>
            <actions>
                <set field="titleProperty" value="PartyFinancialHistory"/>
                <set field="activeSubMenuItem" value="FinancialHistory"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <actions>
                                <entity-condition entity-name="InvoiceAndApplAndPayment" list="ListInvoicesApplPayments">
                                    <condition-list combine="and">
                                        <condition-list combine="or">
                                            <condition-list combine="and">
                                                <condition-expr field-name="partyId" from-field="partyId"/>
                                                <condition-expr field-name="partyIdFrom" from-field="defaultOrganizationPartyId"/>
                                            </condition-list>
                                            <condition-list combine="and">
                                                <condition-expr field-name="partyId" from-field="defaultOrganizationPartyId"/>
                                                <condition-expr field-name="partyIdFrom" from-field="partyId"/>
                                            </condition-list>
                                        </condition-list>
                                        <condition-expr field-name="statusId" operator="not-equals" value="INVOICE_IN_PROCESS"/>
                                        <condition-expr field-name="statusId" operator="not-equals" value="INVOICE_CANCELLED"/>
                                        <condition-expr field-name="statusId" operator="not-equals" value="INVOICE_WRITEOFF"/>
                                    </condition-list>
                                </entity-condition>
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="ListInvoicesApplPayments"/></not>
                                    </condition>
                                    <actions>
                                        <set field="actualCurrency" value="false" type="Boolean"/>
                                        <set field="actualCurrencyUomId" from-field="defaultOrganizationPartyCurrencyUomId"/>
                                    </actions>
                                    <widgets>
                                        <screenlet title="${uiLabelMap.AccountingInvoicesApplPayments}" navigation-form-name="Invoices">
                                            <include-form name="ListInvoicesApplPayments" location="component://party/widget/partymgr/PartyForms.xml"/>
                                            <section>
                                                <condition>
                                                    <and>
                                                        <not><if-empty field="party.preferredCurrencyUomId"/></not>
                                                        <if-compare-field field="defaultOrganizationPartyCurrencyId" operator="not-equals" to-field="party.preferredCurrencyUomId"/>
                                                    </and>
                                                </condition>
                                                <actions>
                                                    <set field="actualCurrency" value="true" type="Boolean"/>
                                                    <set field="actualCurrencyUomId" from-field="party.preferredCurrencyUomId"/>
                                                </actions>
                                                <widgets>
                                                    <label style="heading" text="${uiLabelMap.PartyCurrency}"></label>
                                                    <include-form name="ListInvoicesApplPayments" location="component://party/widget/partymgr/PartyForms.xml"/>
                                                </widgets>
                                            </section>
                                        </screenlet>
                                    </widgets>
                                </section>
                            </widgets>
                        </section>
                        <section>
                            <actions>
                                <set field="actualCurrency" value="false" type="Boolean"/>
                                <set field="actualCurrencyUomId" from-field="defaultOrganizationPartyCurrencyUomId"/>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyInvoicesNotApplied}" navigation-form-name="partyFinancialHistoryInvoicesN">
                                    <include-form name="ListUnAppliedInvoices" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <and>
                                                <not><if-empty field="party.preferredCurrencyUomId"/></not>
                                                <if-compare-field field="defaultOrganizationPartyCurrencyUomId" operator="not-equals" to-field="party.preferredCurrencyUomId"/>
                                            </and>
                                        </condition>
                                        <actions>
                                            <set field="actualCurrency" value="true" type="Boolean"/>
                                            <set field="actualCurrencyUomId" from-field="party.preferredCurrencyUomId"/>
                                        </actions>
                                        <widgets>
                                            <label style="heading" text="${uiLabelMap.PartyCurrency}"></label>
                                            <include-form name="ListUnAppliedInvoices" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <actions>
                                <set field="actualCurrency" value="false" type="Boolean"/>
                                <set field="actualCurrencyUomId" from-field="defaultOrganizationPartyCurrencyId"/>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyPaymentsNotApplied}" navigation-form-name="partyFinancialHistoryPaymentsN">
                                    <include-form name="ListUnAppliedPayments" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <and>
                                                <not><if-empty field="party.preferredCurrencyUomId"/></not>
                                                <if-compare-field field="defaultOrganizationPartyCurrencyId" operator="not-equals" to-field="party.preferredCurrencyUomId"/>
                                            </and>
                                        </condition>
                                        <actions>
                                            <set field="actualCurrency" value="true" type="Boolean"/>
                                            <set field="actualCurrencyUomId" from-field="party.preferredCurrencyUomId"/>
                                        </actions>
                                        <widgets>
                                            <label style="heading" text="${uiLabelMap.PartyCurrency}"></label>
                                            <include-form name="ListUnAppliedPayments" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <actions>
                                <set field="actualCurrency" value="false" type="Boolean"/>
                                <set field="actualCurrencyUomId" from-field="defaultOrganizationPartyCurrencyUomId"/>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.PartyFinancialSummary}${defaultOrganizationPartyId}" navigation-form-name="partyFinancialSummary">
                                    <include-form name="partyFinancialSummary" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    <section>
                                        <condition>
                                            <and>
                                                <not><if-empty field="party.preferredCurrencyUomId"/></not>
                                                <if-compare-field field="defaultOrganizationPartyCurrencyUomId" operator="not-equals" to-field="party.preferredCurrencyUomId"/>
                                            </and>
                                        </condition>
                                        <actions>
                                            <set field="actualCurrency" value="true" type="Boolean"/>
                                            <set field="actualCurrencyUomId" from-field="party.preferredCurrencyUomId"/>
                                        </actions>
                                        <widgets>
                                            <label style="heading" text="${uiLabelMap.PartyCurrency}"></label>
                                            <include-form name="partyFinancialSummary" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <actions>
                                <script location="component://accounting/webapp/accounting/WEB-INF/actions/payment/BillingAccounts.groovy"/>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.AccountingBillingAccount}">
                                    <include-form name="PartyBillingAccount" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                        <section>
                            <actions>
                                <entity-and entity-name="ReturnHeader" list="returnList">
                                    <field-map field-name="fromPartyId" from-field="parameters.partyId"/>
                                </entity-and>
                            </actions>
                            <widgets>
                                <screenlet title="${uiLabelMap.OrderOrderReturns}">
                                    <include-form name="PartyReturns" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </screenlet>
                            </widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="Preferences">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleViewPartyPreferences"/>
                <set field="activeSubMenuItem" value="preferences"/>
                <set field="partyId"  from-field="parameters.partyId"/>
                <entity-and entity-name="EnumTypeChildAndEnum" list="enumTypeChildAndEnums">
                    <field-map field-name="parentEnumTypeId" value="USER_PREF_GROUPS"/>
                </entity-and>
                <entity-and entity-name="UserLogin" list="userLogins">
                    <field-map field-name="partyId" from-field="parameters.partyId"/>
                </entity-and>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <iterate-section entry="userLogin" list="userLogins">
                            <section>
                                <actions>
                                    <set field="userPrefUserLoginId" from-field="userLogin.userLoginId"/>
                                </actions>
                                <widgets>
                                    <screenlet title="${uiLabelMap.CommonPreferences} ${uiLabelMap.CommonFor} userLogin: ${userPrefUserLoginId}" >
                                        <include-form name="ListPreference" location="component://party/widget/partymgr/PartyForms.xml"/>
                                    </screenlet>
                                </widgets>
                            </section>
                        </iterate-section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="PartyGeoLocation">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitlePartyGeoLocation"/>
                <set field="activeSubMenuItem" value="PartyGeoLocation"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/PartyGeoLocation.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <not><if-empty field="geoChart"/></not>
                            </condition>
                            <widgets>
                                <container style="button-bar">
                                    <link target="addGeoLocation" text="${uiLabelMap.CommonUpdate}" style="${styles.link_nav} ${styles.action_update}">
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                    </link>
                                </container>
                                <label>${uiLabelMap.CommonLatitude} ${latestGeoPoint.latitude}</label>
                                <label>${uiLabelMap.CommonLongitude} ${latestGeoPoint.longitude}</label>
                                <label>${uiLabelMap.CommonElevation} ${latestGeoPoint.elevation} ${elevationUomAbbr}</label>
                                <include-screen name="geoChart" location="component://common/widget/CommonScreens.xml"/>
                            </widgets>
                            <fail-widgets>
                                <container style="button-bar">
                                    <link target="addGeoLocation" text="${uiLabelMap.CommonCreateNew}" style="${styles.link_nav} ${styles.action_add}">
                                        <parameter param-name="partyId" from-field="parameters.partyId"/>
                                    </link>
                                </container>
                                <include-screen name="geoChart" location="component://common/widget/CommonScreens.xml"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="GetPartyGeoLocation">
        <section>
            <actions>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="titleProperty" value="PageTitlePartyGeoLocation"/>
                <set field="activeSubMenuItem" value="PartyGeoLocation"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/PartyGeoLocation.groovy"/>
            </actions>
            <widgets>
                <label>${uiLabelMap.CommonLatitude} ${latestGeoPoint.latitude}</label>
                <label>${uiLabelMap.CommonLongitude} ${latestGeoPoint.longitude}</label>
                <label>${uiLabelMap.CommonElevation} ${latestGeoPoint.elevation} ${elevationUomAbbr}</label>
                <include-screen name="geoChart" location="component://common/widget/CommonScreens.xml"/>
            </widgets>
        </section>
    </screen>
    <screen name="EditGeoLocation">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitlePartyGeoLocation"/>
                <set field="activeSubMenuItem" value="PartyGeoLocation"/>
                <set field="partyId" from-field="parameters.partyId"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/GetGeoLocation.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <platform-specific>
                            <html><html-template location="component://party/webapp/partymgr/party/editGeoLocation.ftl"/></html>
                        </platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="CreateUserNotification">
        <section>
            <actions>
                <set field="title" value="${uiLabelMap.MyPortalCustRequestNotificationMailCreation}"/>
            </actions>
            <widgets>
                <decorator-screen name="ScipioEmailDecorator" location="component://common/widget/CommonScreens.xml">
                    <decorator-section name="body">
                        <platform-specific><email><html-template location="component://party/templates/email/CreatePartyNotification.ftl"/></email></platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- PartyIdentification Screen -->
    <screen name="ListPartyIdentifications">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleListPartyIdentifications"/>
                <set field="activeSubMenuItem" value="viewidentifications"/>

                <set field="labelTitleProperty" value="PartyIdentification"/>

                <set field="partyId" from-field="parameters.partyId"/>
                <entity-one entity-name="Party" value-field="party" /><!-- SCIPIO: why risk it? use-cache="true" -->
                <entity-one entity-name="PartyIdentification" value-field="partyIdentification"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet><!-- produces same as page title: title="${uiLabelMap.PartyPartyIdentificationList}" -->
                             <include-form name="listPartyIdentification" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <screenlet title="${uiLabelMap.PartyPartyIdentification}" id="PartyIdentificationCreationPanel"><!-- was removed: navigation-menu-name="newPartyIdentification"  -->
                             <!-- was removed (now crash): <include-menu name="newPartyIdentification" location="component://party/widget/partymgr/PartyMenus.xml"/>-->
                             <section share-scope="false">
                                <actions>
                                    <!-- SCIPIO: null to force form create-only, because listPartyIdentification already provides update -->
                                    <set field="partyIdentification" value="${null}"/>
                                    <!-- false so ignores parameters coming from a successful create/update -->
                                    <set field="useRequestParameters" type="Boolean" value="false"/>
                                </actions>
                                <widgets>
                                    <include-form name="editPartyIdentification" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </widgets>
                             </section>
                         </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="ViewProductStoreRoles">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleFindProductStoreRoles"/>
                <set field="activeSubMenuItem" value="productStoreRoles"/>
                <set field="labelTitleProperty" value="ProductProductStoreRoles"/>
                <set field="parameters.fromDate" from-field="parameters.fromDate" type="Timestamp"/>
                <entity-one entity-name="ProductStoreRole" value-field="productStoreRole" auto-field-map="true"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet title="${uiLabelMap.PageTitleEditProductStoreRoles}">
                            <include-form name="EditProductStoreRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                        </screenlet>
                        <decorator-screen name="FindScreenDecorator" location="component://common/widget/CommonScreens.xml">
                            <decorator-section name="search-options">
                                <include-form name="FindProductStoreRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                            </decorator-section>
                            <decorator-section name="search-results">
                                <include-form name="ListProductStoreRole" location="component://party/widget/partymgr/PartyForms.xml"/>
                            </decorator-section>
                        </decorator-screen>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="postalAddressHtmlFormatter">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="postalAddressTemplateSuffix" value=".ftl"/>
                <set field="addressTemplatePath" value="${sys:getProperty('ofbiz.home')}/applications/party/webapp/partymgr/party/contactmechtemplates/"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/GetPostalAddressTemplate.groovy"/>
            </actions>
            <widgets>
                <platform-specific>
                    <html>
                        <html-template location="component://party/webapp/partymgr/party/contactmechtemplates/${postalAddressTemplate}"/>
                    </html>
                </platform-specific>
            </widgets>
        </section>
    </screen>
    <screen name="postalAddressPdfFormatter">
        <section>
            <actions>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="postalAddressTemplateSuffix" value=".fo.ftl"/>
                <set field="addressTemplatePath" value="${sys:getProperty('ofbiz.home')}/applications/party/webapp/partymgr/party/contactmechtemplates/"/>
                <script location="component://party/webapp/partymgr/WEB-INF/actions/party/GetPostalAddressTemplate.groovy"/>
            </actions>
            <widgets>
                <platform-specific>
                    <xsl-fo>
                        <html-template location="component://party/webapp/partymgr/party/contactmechtemplates/${postalAddressTemplate}"/>
                    </xsl-fo>
                </platform-specific>
            </widgets>
        </section>
    </screen>
    <screen name="ImportExport">
        <section>
            <actions>
                <set field="titleProperty" value="CommonImportExport"/>
                <set field="activeSubMenuItem" value="importexport"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPartyAppDecorator" location="${parameters.mainDecoratorLocation}">
                    <decorator-section name="body">
                        <screenlet>
                            <label text="${uiLabelMap.PartyParty} ${uiLabelMap.CommonImportExport} ID Name, single role (employee, customer, supplier) and contactmechs" />
                            <container style="${styles.grid_row}">
                                <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                    <label style="heading">${uiLabelMap.CommonImport}</label>
                                    <section>
                                        <actions>          
                                            <set field="showProgress" type="Boolean" value="true" /> 
                                            <set field="progressSuccessAction" value="none" /> <!-- success is enough: redirect;;ImportExport -->
                                            <set field="progressOptions" value="{}" />
                                        </actions>
                                        <widgets>
                                            <include-form name="ImportParty" location="component://party/widget/partymgr/PartyForms.xml"/>
                                        </widgets>
                                    </section>
                                </container>
                                <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                    <label style="heading">${uiLabelMap.CommonExport}</label>
                                    <include-form name="ExportParty" location="component://party/widget/partymgr/PartyForms.xml"/>
                                </container>
                            </container>
                         </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="PartyExportCsv">
        <section>
            <actions>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="organizationPartyId" from-field="parameters.organizationPartyId"/>
            </actions>
            <widgets>
                <include-form name="ExportPartyCsv" location="component://party/widget/partymgr/PartyForms.xml"/>           
            </widgets>
        </section>
    </screen>
    
</screens>
