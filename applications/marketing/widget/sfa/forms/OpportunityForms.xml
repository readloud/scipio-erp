<?xml version="1.0" encoding="UTF-8"?>
<!--
This file is subject to the terms and conditions defined in the
files 'LICENSE' and 'NOTICE', which are part of this source
code package.
-->

<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-form.xsd">

    <form name="FindSalesOpportunity" type="single" target="FindSalesOpportunity"
        header-row-style="header-row"> <!-- orig: default-table-style=-style="basic-table" -->
        <field name="salesOpportunityId"><hidden/></field>
        <field name="opportunityName" title="${uiLabelMap.SfaFindOpportunities}"><text-find size="25"></text-find></field>
        <field name="partyId" title="${uiLabelMap.SfaLead}"><lookup target-form-name="LookupLeads"/></field>
        <field name="opportunityStageId" title="${uiLabelMap.SfaInitialStage}">
            <drop-down allow-empty="true">
                <entity-options description="${description}" entity-name="SalesOpportunityStage">
                    <entity-order-by field-name="sequenceNum"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="typeEnumId" title="${uiLabelMap.SfaType}">
            <drop-down allow-empty="true">
                <entity-options key-field-name="enumId" description="${description}" entity-name="Enumeration">
                    <entity-constraint name="enumTypeId" operator="equals" value="SLSOPP_TYP_ENUM"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="searchAction" title="${uiLabelMap.CommonFind}" widget-style="${styles.link_run_sys} ${styles.action_find}"><submit/></field>
    </form>

    <form name="ListSalesOpportunity" type="list" list-name="listIt" paginate-target="FindSalesOpportunity" view-size="20"
        odd-row-style="alternate-row" header-row-style="header-row-2"> <!-- orig: default-table-style=-style="basic-table hover-bar" -->
        <actions>
            <set field="parameters.noConditionFind" value="Y"/>
            <set field="opportunityStageId" from-field="parameters.opportunityStageId"/>
            <set field="parameters.opportunityStageId" value="${groovy:opportunityStageId==null?'SOSTG_CLOSED':opportunityStageId}"/>
            <set field="parameters.opportunityStageId_op" value="${groovy:opportunityStageId==null?'notEqual':'equals'}"/>
            <set field="fieldList" value="${groovy:['partyId','salesOpportunityId','opportunityStageId','typeEnumId', 'roleTypeId']}" type="List"/>
            <set field="sortField" from-field="parameters.sortField" default-value="salesOpportunityId"/>
            <service service-name="performFind" result-map="result" result-map-list="listIt">
                <field-map field-name="inputFields" from-field="parameters"/>
                <field-map field-name="entityName" value="SalesOpportunityAndRole"/>
                <field-map field-name="orderBy" value="${sortField}"/>
                <field-map field-name="fieldList" from-field="fieldList"/>
                <field-map field-name="distinct" value="Y"/>
                <field-map field-name="viewIndex" from-field="viewIndex"/>
                <field-map field-name="viewSize" from-field="viewSize"/>
            </service>
        </actions>
        <row-actions>
            <entity-one entity-name="SalesOpportunity" value-field="salesOpportunity"/>
        </row-actions>
        <field name="salesOpportunityId"><hidden/></field>
        <field name="opportunityName" title="${uiLabelMap.SfaOpportunityName}" widget-style="${styles.link_nav_info_desc} ${styles.action_view}">
            <hyperlink target="EditSalesOpportunity" description="${opportunityName} [${salesOpportunityId}] ${roleTypeId}">
                <parameter param-name="salesOpportunityId"/>
            </hyperlink>
        </field>
        <field name="opportunityStageId" title="${uiLabelMap.SfaInitialStage}"><display-entity entity-name="SalesOpportunityStage" description="${description}"/></field>
        <field name="partyId" title="${uiLabelMap.SfaLead}/${uiLabelMap.Account}">
            <display-entity entity-name="PartyNameView" description="${firstName} ${lastName} ${middleName} ${groupName}" key-field-name="partyId">
                <sub-hyperlink target="viewprofile" description="[${partyId}]" link-style="${styles.link_nav_info_id}">
                    <parameter param-name="partyId" from-field="partyId"/>
                </sub-hyperlink>
            </display-entity> 
        </field>
        <field name="roleTypeId"><display-entity entity-name="RoleType"/></field>
        <field name="nextStep"><display/></field>
        <field name="estimatedAmount" title="${uiLabelMap.SfaEstimatedAmount}"><display/></field>
        <field name="nextStepDate" title="${uiLabelMap.SfaNextStepDate}" sort-field="true"><display/></field>
        <field name="estimatedCloseDate" title="${uiLabelMap.SfaCloseDate}"><display/></field>
        <field name="editAction" title="${uiLabelMap.CommonClose}" use-when="estimatedCloseDate == void || estimatedCloseDate == null || org.ofbiz.base.util.UtilValidate.isDateAfterNow(estimatedCloseDate) || opportunityStageId != &quot;SOSTG_CLOSED&quot;" widget-style="${styles.link_run_sys} ${styles.action_terminate}">
            <hyperlink target="closeSalesOpportunity" description="${uiLabelMap.CommonClose}">
                <parameter param-name="salesOpportunityId"/>
                <parameter param-name="opportunityStageId" value="SOSTG_CLOSED"/>
            </hyperlink>
        </field>
    </form>

    <form name="EditSalesOpportunity" type="single" target="updateSalesOpportunity" default-map-name="salesOpportunity"
        header-row-style="header-row"> <!-- orig: default-table-style=-style="basic-table" -->
        <alt-target use-when="salesOpportunity==null" target="createSalesOpportunity"/>
        <field name="salesOpportunityId" use-when="salesOpportunity!=null" tooltip="${uiLabelMap.CommonNotModifRecreat}"><display/></field>
        <field name="salesOpportunityId" use-when="salesOpportunity==null&amp;&amp;salesOpportunityId==null"><text/></field>
        <field name="salesOpportunityId" use-when="salesOpportunity==null&amp;&amp;salesOpportunityId!=null" tooltip="${uiLabelMap.CommonCannotBeFound}: [${salesOpportunityId}]"><display/></field>
        <field name="opportunityName" title="${uiLabelMap.SfaOpportunityName}"><text default-value="${communicationEvent.subject}" size="30"/></field>
        <field name="description" title="${uiLabelMap.MarketingSegmentGroupDescription}"><textarea default-value="${communicationEvent.content}"/></field>
        <field name="nextStep" title="${uiLabelMap.SfaNextStep}"><textarea/></field>
        <field name="estimatedAmount" position="1" title="${uiLabelMap.SfaEstimatedAmount}"><text size="25"/></field>
        <field name="estimatedProbability" position="2" title="${uiLabelMap.SfaProbability}"><text size="25"/></field>
        <field name="marketingCampaignId" position="1" title="${uiLabelMap.MarketingCampaign}">
            <drop-down allow-empty="true">
                <entity-options description="${campaignName}" entity-name="MarketingCampaign" key-field-name="marketingCampaignId">
                </entity-options>
            </drop-down>
        </field>
        <field name="currencyUomId" position="2" title="${uiLabelMap.CommonCurrency}">
            <drop-down allow-empty="true" no-current-selected-key="${defaultOrganizationPartyCurrencyUomId}">
                <entity-options key-field-name="uomId" description="${description} - ${abbreviation}" entity-name="Uom">
                    <entity-constraint name="uomTypeId" operator="equals" value="CURRENCY_MEASURE"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="nextStepDate" position="1" title="${uiLabelMap.SfaNextStepDate}"><date-time/></field>
        <field name="estimatedCloseDate" position="2" title="${uiLabelMap.SfaCloseDate}"><date-time/></field>
        <field name="opportunityStageId" position="1" title="${uiLabelMap.SfaInitialStage}">
            <drop-down>
                <entity-options description="${description}" entity-name="SalesOpportunityStage">
                    <entity-order-by field-name="sequenceNum"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="typeEnumId" position="2" title="${uiLabelMap.SfaType}">
            <drop-down allow-empty="true">
                <entity-options key-field-name="enumId" description="${description}" entity-name="Enumeration">
                    <entity-constraint name="enumTypeId" operator="equals" value="SLSOPP_TYP_ENUM"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="dataSourceId" use-when="communicationEvent==null" position="1" title="${uiLabelMap.SfaDataSourceLabel}">
            <drop-down allow-empty="true">
                <entity-options key-field-name="dataSourceId" description="${description}" entity-name="DataSource">
                    <entity-constraint name="dataSourceTypeId" operator="equals" value="LEAD_SOURCE"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="dataSourceId" use-when="communicationEvent!=null" position="1" title="${uiLabelMap.SfaDataSourceLabel}">
            <drop-down allow-empty="false" no-current-selected-key="EMAIL">
                <entity-options key-field-name="dataSourceId" description="${description}" entity-name="DataSource">
                    <entity-constraint name="dataSourceTypeId" operator="equals" value="LEAD_SOURCE"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="accountPartyId" use-when="communicationEvent==null" title="${uiLabelMap.SfaInitialAccount}" ><lookup target-form-name="LookupAccounts" default-value="${accountPartyId}"/></field>
        <field name="accountPartyId" use-when="communicationEvent!=null" title="${uiLabelMap.SfaInitialAccount}" ><lookup target-form-name="LookupAccounts" default-value="${accountPartyId}"/></field>
        <field name="leadPartyId" use-when="communicationEvent==null" title="${uiLabelMap.SfaLead}"><lookup target-form-name="LookupLeads" default-value="${leadPartyId}"/></field>
        <field name="leadPartyId" use-when="communicationEvent!=null" title="${uiLabelMap.SfaLead}"><lookup target-form-name="LookupLeads" default-value="${communicationEvent.partyIdFrom}"/></field>
        <field name="submitAction" title="${uiLabelMap.CommonSave}" widget-style="${styles.link_run_sys} ${styles.action_add}" use-when="salesOpportunity==null"><submit button-type="button"/></field>
        <field name="submitAction" title="${uiLabelMap.CommonUpdate}" widget-style="${styles.link_run_sys} ${styles.action_update}" use-when="salesOpportunity!=null"><submit button-type="button"/></field>
    </form>

    <form name="ViewSalesOpportunity" type="single" default-map-name="salesOpportunity"
        header-row-style="header-row"> <!-- orig: default-table-style=-style="basic-table" -->
        <field name="salesOpportunityId"><display/></field>
        <field name="opportunityName" position="1" title="${uiLabelMap.SfaOpportunityName}"><display/></field>
        <field name="accountPartyId" position="1" title="${uiLabelMap.SfaInitialAccount}" map-name="accountParty" field-name="partyId"><display-entity description="${firstName} ${lastName} ${groupName} [${partyId}]" entity-name="PartyNameView"/></field>
        <field name="leadPartyId" position="1" title="${uiLabelMap.SfaLead}" map-name="leadParty" field-name="partyId"><display-entity description="${firstName} ${lastName} ${groupName} [${partyId}]" entity-name="PartyNameView"/></field>
        <field name="estimatedAmount" position="1" title="${uiLabelMap.SfaEstimatedAmount} ${currencyUomId}"><display/></field>
        <field name="estimatedProbability" position="2" title="${uiLabelMap.SfaProbability}"><display/></field>
        <field name="nextStepDate" position="1" title="${uiLabelMap.SfaNextStepDate}"><display/></field>
        <field name="estimatedCloseDate" position="2" title="${uiLabelMap.SfaCloseDate}"><display/></field>
        <field name="opportunityStageId" position="1" title="${uiLabelMap.SfaInitialStage}">
            <display-entity entity-name="SalesOpportunityStage" description="${description}"/>
        </field>
        <field name="typeEnumId" position="2" title="${uiLabelMap.SfaType}"><display-entity entity-name="Enumeration" key-field-name="enumId" description="${description}"/></field>
        <field name="marketingCampaignId" position="1" title="${uiLabelMap.MarketingCampaign}"><display/></field>
        <field name="currencyUomId" position="2" title="${uiLabelMap.CommonCurrency}"><display/></field>
        <field name="dataSourceId" position="1" title="${uiLabelMap.SfaDataSourceLabel}"><display/></field>
        <field name="description" position="1" title="${uiLabelMap.MarketingSegmentGroupDescription}"><display/></field>
        <field name="nextStep" position="1" title="${uiLabelMap.SfaNextStep}"><display/></field>
    </form>
</forms>
